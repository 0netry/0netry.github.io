{"title":"恶意iso文件分析","uid":"0fa9719b9833354b768a1db954a5b0e7","slug":"恶意iso文件分析","date":"2023-04-08T02:22:11.000Z","updated":"2025-06-05T09:33:11.016Z","comments":true,"path":"api/articles/恶意iso文件分析.json","keywords":null,"cover":null,"content":"<h2 id=\"iso信息\"><a href=\"#iso信息\" class=\"headerlink\" title=\"iso信息\"></a>iso信息</h2><h3 id=\"文件信息\"><a href=\"#文件信息\" class=\"headerlink\" title=\"文件信息\"></a>文件信息</h3><p>![img](.\\Dark Pink APT Group Strikes Government Entities in South\\iso信息.png)</p>\n<h3 id=\"文件内容\"><a href=\"#文件内容\" class=\"headerlink\" title=\"文件内容\"></a>文件内容</h3><p>![img](.\\Dark Pink APT Group Strikes Government Entities in South\\iso内容.png)</p>\n<h2 id=\"doc文档\"><a href=\"#doc文档\" class=\"headerlink\" title=\"doc文档\"></a>doc文档</h2><h3 id=\"doc加密数据\"><a href=\"#doc加密数据\" class=\"headerlink\" title=\"doc加密数据\"></a>doc加密数据</h3><p>![img](.\\Dark Pink APT Group Strikes Government Entities in South\\doc加密数据.png)</p>\n<h2 id=\"WinWord-exe\"><a href=\"#WinWord-exe\" class=\"headerlink\" title=\"WinWord.exe\"></a>WinWord.exe</h2><p>即Concept Note Strategic Dialog Version 30.1.docx.exe</p>\n<h3 id=\"签名信息\"><a href=\"#签名信息\" class=\"headerlink\" title=\"签名信息\"></a>签名信息</h3><p>![img](.\\Dark Pink APT Group Strikes Government Entities in South\\WinWord_exe签名信息.png)</p>\n<h3 id=\"详细信息\"><a href=\"#详细信息\" class=\"headerlink\" title=\"详细信息\"></a>详细信息</h3><p>![img](.\\Dark Pink APT Group Strikes Government Entities in South\\WinWord_exe详细信息.png)</p>\n<h3 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h3><p>运行Concept Note Strategic Dialog Version 30.1.docx.exe</p>\n<h4 id=\"加载当前目录下的MSVCR100-dll\"><a href=\"#加载当前目录下的MSVCR100-dll\" class=\"headerlink\" title=\"加载当前目录下的MSVCR100.dll\"></a>加载当前目录下的MSVCR100.dll</h4><p>![img](.\\Dark Pink APT Group Strikes Government Entities in South\\iso目录结构.png)</p>\n<p>使用process monitor监控</p>\n<p>![img](.\\Dark Pink APT Group Strikes Government Entities in South\\加载MSVCR100_dll.png)</p>\n<p>使用Dependency walker监控</p>\n<p>![image-20230323102713096](.\\Dark Pink APT Group Strikes Government Entities in South\\使用Dependency_walker监控.png)</p>\n<h4 id=\"创建注册表项\"><a href=\"#创建注册表项\" class=\"headerlink\" title=\"创建注册表项\"></a>创建注册表项</h4><p>dll创建的</p>\n<p>![img](.\\Dark Pink APT Group Strikes Government Entities in South\\创建注册表项_前提.png)</p>\n<p>![img](.\\Dark Pink APT Group Strikes Government Entities in South\\创建注册表项.png)</p>\n<p>该项主要是通过powershell启动MSBild.exe运行解密出的project xml文件。dll创建的</p>\n<p>![img](.\\Dark Pink APT Group Strikes Government Entities in South\\注册表信息.png)</p>\n<h4 id=\"创建定时任务\"><a href=\"#创建定时任务\" class=\"headerlink\" title=\"创建定时任务\"></a>创建定时任务</h4><p>dll创建的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SCHTASKS /CREATE /f /TN &quot;Health Check&quot; /TR &quot;shutdown /l /f&quot; /SC WEEKLY /d WED,FRI /ST 13:15</span><br></pre></td></tr></table></figure>\n\n<p>每周三和周五13:15强行关闭应用程序并注销当前用户;</p>\n<p>最后创建名为“Health Check”的计划任务，在每周三、周五的13：15分启动，其操作为注销电脑，从而触发注册表winlogon项，以此实现驻留</p>\n<p>![image-20230322145034471](.\\Dark Pink APT Group Strikes Government Entities in South\\创建定时任务.png)</p>\n<h2 id=\"MSVCR100-dll\"><a href=\"#MSVCR100-dll\" class=\"headerlink\" title=\"MSVCR100.dll\"></a>MSVCR100.dll</h2><h3 id=\"MSVCR100-dll信息\"><a href=\"#MSVCR100-dll信息\" class=\"headerlink\" title=\"MSVCR100.dll信息\"></a>MSVCR100.dll信息</h3><p>![image-20230323114643295](.\\Dark Pink APT Group Strikes Government Entities in South\\MSVCR100_dll信息.png)</p>\n<h3 id=\"第一个功能函数\"><a href=\"#第一个功能函数\" class=\"headerlink\" title=\"第一个功能函数\"></a>第一个功能函数</h3><p>查找iso解压目录中隐藏的以~开头的doc诱饵文件，并与0xCA进行异或解密</p>\n<p>![image-20230323155558610](.\\Dark Pink APT Group Strikes Government Entities in South\\静态分析-查找诱饵文档并解密.png)</p>\n<p>解密得到xml文件</p>\n<p>![image-20230327104402520](.\\Dark Pink APT Group Strikes Government Entities in South\\动态分析-解密诱饵文档.png)</p>\n<p>保存到临时文件夹的临时文件wct1FDA.tmp中</p>\n<p>![image-20230327113633960](.\\Dark Pink APT Group Strikes Government Entities in South\\wct1FDA_tmp.png)</p>\n<p>解密启动winword打开诱饵文档的命令</p>\n<p>![](.\\Dark Pink APT Group Strikes Government Entities in South\\解密启动winword打开诱饵文档的命令.png)</p>\n<p>创建进程执行启动windword打开诱饵文档命令</p>\n<p>![image-20230323203550921](.\\Dark Pink APT Group Strikes Government Entities in South\\创建进程执行启动windword打开诱饵文档命令.png)</p>\n<h3 id=\"第二个功能函数\"><a href=\"#第二个功能函数\" class=\"headerlink\" title=\"第二个功能函数\"></a>第二个功能函数</h3><p>![image-20230323203550921](.\\Dark Pink APT Group Strikes Government Entities in South\\解密MSBuild注册表项.png)</p>\n<p>![image-20230323203506082](.\\Dark Pink APT Group Strikes Government Entities in South\\image-20230323203506082.png)</p>\n<p>![image-20230323203636065](.\\Dark Pink APT Group Strikes Government Entities in South\\image-20230323203636065.png)</p>\n<p>![image-20230324100836519](.\\Dark Pink APT Group Strikes Government Entities in South\\获取临时文件路径.png)</p>\n<p>%TEMP%&#x2F;&#x2F;wct1FDA.tmp</p>\n<p>![image-20230324103323642](.\\Dark Pink APT Group Strikes Government Entities in South\\追加临时文件路径.png)</p>\n<p>环境变量以加密方式存储在加载程序的数据部分内，并且 XOR 解密密钥（“0xa7”）在执行期间静态地用于执行解密。</p>\n<p>![image-20230324114949196](.\\Dark Pink APT Group Strikes Government Entities in South\\解密powershell.png)</p>\n<p>![image-20230324115223508](.\\Dark Pink APT Group Strikes Government Entities in South\\创建各类注册表项.png)</p>\n<p>解密计划任务命令（xor 0xA7）</p>\n<p>![image-20230324153719531](.\\Dark Pink APT Group Strikes Government Entities in South\\计划任务命令.png)</p>\n<p>![image-20230324153633081](.\\Dark Pink APT Group Strikes Government Entities in South\\解密计划任务命令.png)</p>\n<p>![image-20230324144527408](.\\Dark Pink APT Group Strikes Government Entities in South\\动态分析-解密计划任务命令.png)</p>\n<p>创建进程启动定时任务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rdx=00000000003ED3F0 L&quot;SCHTASKS /CREATE /f /TN \\&quot;Health Check\\&quot; /TR \\&quot;shutdown /l /f\\&quot; /SC WEEKLY /d WED,FRI /ST 13:15&quot;</span><br></pre></td></tr></table></figure>\n\n<p>![](.\\Dark Pink APT Group Strikes Government Entities in South\\创建进程启动定时任务.png)</p>\n<h2 id=\"附录\"><a href=\"#附录\" class=\"headerlink\" title=\"附录\"></a>附录</h2><p>iso：</p>\n<ul>\n<li>SHA256: 205f6808ab05ff3932ee799f37c227a7a950e07ea97f51d206e0563c83592e60</li>\n<li>MD5: 836184b7387b212f8b7f064d5e60f587</li>\n<li>SHA1: fcefbe984fa0e343ec51cb22b6119014a6b1ee36</li>\n</ul>\n<h2 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h2><p><a href=\"https://blog.csdn.net/weixin_44657888/article/details/121192197?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-121192197-blog-72900036.pc_relevant_multi_platform_whitelistv3&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-121192197-blog-72900036.pc_relevant_multi_platform_whitelistv3\">Schtasks（计划任务）命令详解-转载</a></p>\n<p><a href=\"https://www.xitongcheng.com/jiaocheng/dnrj_article_68551.html\">windows系统shutdown命令大全详解</a></p>\n<p><a href=\"https://www.jianshu.com/p/f728899ea71b\">浅谈powershell</a></p>\n","feature":true,"text":"iso信息文件信息![img](.\\Dark Pink APT Group Strikes Government Entities in South\\iso信息...","permalink":"/post/恶意iso文件分析","photos":[],"count_time":{"symbolsCount":"3.9k","symbolsTime":"4 mins."},"categories":[],"tags":[{"name":"恶意样本","slug":"恶意样本","count":2,"path":"api/tags/恶意样本.json"},{"name":"逆向","slug":"逆向","count":2,"path":"api/tags/逆向.json"},{"name":"iso文件","slug":"iso文件","count":1,"path":"api/tags/iso文件.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#iso%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">iso信息</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">文件信息</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9\"><span class=\"toc-text\">文件内容</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#doc%E6%96%87%E6%A1%A3\"><span class=\"toc-text\">doc文档</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#doc%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">doc加密数据</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#WinWord-exe\"><span class=\"toc-text\">WinWord.exe</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AD%BE%E5%90%8D%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">签名信息</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">详细信息</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%90%E8%A1%8C\"><span class=\"toc-text\">运行</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%8A%A0%E8%BD%BD%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84MSVCR100-dll\"><span class=\"toc-text\">加载当前目录下的MSVCR100.dll</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E6%B3%A8%E5%86%8C%E8%A1%A8%E9%A1%B9\"><span class=\"toc-text\">创建注册表项</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1\"><span class=\"toc-text\">创建定时任务</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#MSVCR100-dll\"><span class=\"toc-text\">MSVCR100.dll</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#MSVCR100-dll%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">MSVCR100.dll信息</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8A%9F%E8%83%BD%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">第一个功能函数</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8A%9F%E8%83%BD%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">第二个功能函数</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%99%84%E5%BD%95\"><span class=\"toc-text\">附录</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\"><span class=\"toc-text\">参考链接</span></a></li></ol>","author":{"name":"0netry","slug":"blog-author","avatar":"/img/tree.png","link":"/","description":"0与1只在一念之间","socials":{"github":"https://github.com/0netry","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"某白加黑木马样本分析","uid":"d8609f7faf5edcbbc1a1648becebe73e","slug":"某白加黑木马样本分析","date":"2025-05-28T05:39:13.000Z","updated":"2025-06-05T09:30:58.265Z","comments":true,"path":"api/articles/某白加黑木马样本分析.json","keywords":null,"cover":[],"text":"一、概述样本基本信息（4个文件）样本名称：a5c0Lm.exe、ClassicExplorer32.dll、ffff.pol、ffff.lop MD5：ae10...","permalink":"/post/某白加黑木马样本分析","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"恶意样本","slug":"恶意样本","count":2,"path":"api/tags/恶意样本.json"},{"name":"白加黑技术","slug":"白加黑技术","count":1,"path":"api/tags/白加黑技术.json"},{"name":"逆向","slug":"逆向","count":2,"path":"api/tags/逆向.json"}],"author":{"name":"0netry","slug":"blog-author","avatar":"/img/tree.png","link":"/","description":"0与1只在一念之间","socials":{"github":"https://github.com/0netry","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"HotFix Hook","uid":"d3476856058b1cb70ed747b50ca39e21","slug":"HotFix Hook","date":"2022-03-28T03:12:13.000Z","updated":"2025-06-04T10:06:15.985Z","comments":true,"path":"api/articles/HotFix Hook.json","keywords":null,"cover":null,"text":"API代码修改技术的问题对于全局API钩取——基于Win10的隐藏notepad.exe练习——stealth2.cpp——NewCreateProcessA(...","permalink":"/post/HotFix Hook","photos":[],"count_time":{"symbolsCount":"20k","symbolsTime":"18 mins."},"categories":[],"tags":[{"name":"hook技术","slug":"hook技术","count":6,"path":"api/tags/hook技术.json"},{"name":"逆向工程核心原理","slug":"逆向工程核心原理","count":6,"path":"api/tags/逆向工程核心原理.json"},{"name":"API hook","slug":"API-hook","count":5,"path":"api/tags/API-hook.json"}],"author":{"name":"0netry","slug":"blog-author","avatar":"/img/tree.png","link":"/","description":"0与1只在一念之间","socials":{"github":"https://github.com/0netry","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}