{"title":"恶意iso文件分析","uid":"0fa9719b9833354b768a1db954a5b0e7","slug":"恶意iso文件分析","date":"2023-04-08T02:22:11.000Z","updated":"2025-06-05T12:30:07.178Z","comments":true,"path":"api/articles/恶意iso文件分析.json","keywords":null,"cover":[],"content":"<h2 id=\"iso信息\"><a href=\"#iso信息\" class=\"headerlink\" title=\"iso信息\"></a>iso信息</h2><h3 id=\"文件信息\"><a href=\"#文件信息\" class=\"headerlink\" title=\"文件信息\"></a>文件信息</h3><p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E6%81%AF.png\" alt=\"img\"></p>\n<h3 id=\"文件内容\"><a href=\"#文件内容\" class=\"headerlink\" title=\"文件内容\"></a>文件内容</h3><p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E5%AE%B9.png\" alt=\"img\"></p>\n<h2 id=\"doc文档\"><a href=\"#doc文档\" class=\"headerlink\" title=\"doc文档\"></a>doc文档</h2><h3 id=\"doc加密数据\"><a href=\"#doc加密数据\" class=\"headerlink\" title=\"doc加密数据\"></a>doc加密数据</h3><p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E5%AF%86%E6%95%B0%E6%8D%AE.png\" alt=\"img\"></p>\n<h2 id=\"WinWord-exe\"><a href=\"#WinWord-exe\" class=\"headerlink\" title=\"WinWord.exe\"></a>WinWord.exe</h2><p>即Concept Note Strategic Dialog Version 30.1.docx.exe</p>\n<h3 id=\"签名信息\"><a href=\"#签名信息\" class=\"headerlink\" title=\"签名信息\"></a>签名信息</h3><p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/ord_exe%E7%AD%BE%E5%90%8D%E4%BF%A1%E6%81%AF.png\" alt=\"img\"></p>\n<h3 id=\"详细信息\"><a href=\"#详细信息\" class=\"headerlink\" title=\"详细信息\"></a>详细信息</h3><p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/ord_exe%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF.png\" alt=\"img\"></p>\n<h3 id=\"运行\"><a href=\"#运行\" class=\"headerlink\" title=\"运行\"></a>运行</h3><p>运行Concept Note Strategic Dialog Version 30.1.docx.exe</p>\n<h4 id=\"加载当前目录下的MSVCR100-dll\"><a href=\"#加载当前目录下的MSVCR100-dll\" class=\"headerlink\" title=\"加载当前目录下的MSVCR100.dll\"></a>加载当前目录下的MSVCR100.dll</h4><p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E5%BD%95%E7%BB%93%E6%9E%84.png\" alt=\"img\"></p>\n<p>使用process monitor监控</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/VCR100_dll.png\" alt=\"img\"></p>\n<p>使用Dependency walker监控</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/pendency_walker%E7%9B%91%E6%8E%A7.png\" alt=\"image-20230323102713096\"></p>\n<h4 id=\"创建注册表项\"><a href=\"#创建注册表项\" class=\"headerlink\" title=\"创建注册表项\"></a>创建注册表项</h4><p>dll创建的</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E8%A1%A8%E9%A1%B9_%E5%89%8D%E6%8F%90.png\" alt=\"img\"></p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E8%A1%A8%E9%A1%B9.png\" alt=\"img\"></p>\n<p>该项主要是通过powershell启动MSBild.exe运行解密出的project xml文件。dll创建的</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E6%81%AF.png\" alt=\"img\"></p>\n<h4 id=\"创建定时任务\"><a href=\"#创建定时任务\" class=\"headerlink\" title=\"创建定时任务\"></a>创建定时任务</h4><p>dll创建的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SCHTASKS /CREATE /f /TN &quot;Health Check&quot; /TR &quot;shutdown /l /f&quot; /SC WEEKLY /d WED,FRI /ST 13:15</span><br></pre></td></tr></table></figure>\n\n<p>每周三和周五13:15强行关闭应用程序并注销当前用户;</p>\n<p>最后创建名为“Health Check”的计划任务，在每周三、周五的13：15分启动，其操作为注销电脑，从而触发注册表winlogon项，以此实现驻留</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E4%BB%BB%E5%8A%A1.png\" alt=\"image-20230322145034471\"></p>\n<h2 id=\"MSVCR100-dll\"><a href=\"#MSVCR100-dll\" class=\"headerlink\" title=\"MSVCR100.dll\"></a>MSVCR100.dll</h2><h3 id=\"MSVCR100-dll信息\"><a href=\"#MSVCR100-dll信息\" class=\"headerlink\" title=\"MSVCR100.dll信息\"></a>MSVCR100.dll信息</h3><p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/R100_dll%E4%BF%A1%E6%81%AF.png\" alt=\"image-20230323114643295\"></p>\n<h3 id=\"第一个功能函数\"><a href=\"#第一个功能函数\" class=\"headerlink\" title=\"第一个功能函数\"></a>第一个功能函数</h3><p>查找iso解压目录中隐藏的以~开头的doc诱饵文件，并与0xCA进行异或解密</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/-%E6%9F%A5%E6%89%BE%E8%AF%B1%E9%A5%B5%E6%96%87%E6%A1%A3%E5%B9%B6%E8%A7%A3%E5%AF%86.png\" alt=\"image-20230323155558610\"></p>\n<p>解密得到xml文件</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/-%E8%A7%A3%E5%AF%86%E8%AF%B1%E9%A5%B5%E6%96%87%E6%A1%A3.png\" alt=\"image-20230327104402520\"></p>\n<p>保存到临时文件夹的临时文件wct1FDA.tmp中</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/FDA_tmp.png\" alt=\"image-20230327113633960\"></p>\n<p>解密启动winword打开诱饵文档的命令</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/winword%E6%89%93%E5%BC%80%E8%AF%B1%E9%A5%B5%E6%96%87%E6%A1%A3%E7%9A%84%E5%91%BD%E4%BB%A4.png\"></p>\n<p>创建进程执行启动windword打开诱饵文档命令</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E6%89%A7%E8%A1%8C%E5%90%AF%E5%8A%A8windword%E6%89%93%E5%BC%80%E8%AF%B1%E9%A5%B5%E6%96%87%E6%A1%A3%E5%91%BD%E4%BB%A4.png\" alt=\"image-20230323203550921\"></p>\n<h3 id=\"第二个功能函数\"><a href=\"#第二个功能函数\" class=\"headerlink\" title=\"第二个功能函数\"></a>第二个功能函数</h3><p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/Build%E6%B3%A8%E5%86%8C%E8%A1%A8%E9%A1%B9.png\" alt=\"image-20230323203550921\"></p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/e-20230323203506082.png\" alt=\"image-20230323203506082\"></p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/e-20230323203636065.png\" alt=\"image-20230323203636065\"></p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84.png\" alt=\"image-20230324100836519\"></p>\n<p>%TEMP%&#x2F;&#x2F;wct1FDA.tmp</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84.png\" alt=\"image-20230324103323642\"></p>\n<p>环境变量以加密方式存储在加载程序的数据部分内，并且 XOR 解密密钥（“0xa7”）在执行期间静态地用于执行解密。</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/wershell.png\" alt=\"image-20230324114949196\"></p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E6%B3%A8%E5%86%8C%E8%A1%A8%E9%A1%B9.png\" alt=\"image-20230324115223508\"></p>\n<p>解密计划任务命令（xor 0xA7）</p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E5%91%BD%E4%BB%A4.png\" alt=\"image-20230324153719531\"></p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E4%BB%BB%E5%8A%A1%E5%91%BD%E4%BB%A4.png\" alt=\"image-20230324153633081\"></p>\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/-%E8%A7%A3%E5%AF%86%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%91%BD%E4%BB%A4.png\" alt=\"image-20230324144527408\"></p>\n<p>创建进程启动定时任务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rdx=00000000003ED3F0 L&quot;SCHTASKS /CREATE /f /TN \\&quot;Health Check\\&quot; /TR \\&quot;shutdown /l /f\\&quot; /SC WEEKLY /d WED,FRI /ST 13:15&quot;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/post/GitHub%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/%E5%90%AF%E5%8A%A8%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1.png\"></p>\n<h2 id=\"附录\"><a href=\"#附录\" class=\"headerlink\" title=\"附录\"></a>附录</h2><p>iso：</p>\n<ul>\n<li>SHA256: 205f6808ab05ff3932ee799f37c227a7a950e07ea97f51d206e0563c83592e60</li>\n<li>MD5: 836184b7387b212f8b7f064d5e60f587</li>\n<li>SHA1: fcefbe984fa0e343ec51cb22b6119014a6b1ee36</li>\n</ul>\n<h2 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h2><p><a href=\"https://blog.csdn.net/weixin_44657888/article/details/121192197?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-121192197-blog-72900036.pc_relevant_multi_platform_whitelistv3&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-121192197-blog-72900036.pc_relevant_multi_platform_whitelistv3\">Schtasks（计划任务）命令详解-转载</a></p>\n<p><a href=\"https://www.xitongcheng.com/jiaocheng/dnrj_article_68551.html\">windows系统shutdown命令大全详解</a></p>\n<p><a href=\"https://www.jianshu.com/p/f728899ea71b\">浅谈powershell</a></p>\n","feature":true,"text":"iso信息文件信息 文件内容 doc文档doc加密数据 WinWord.exe即Concept Note Strategic Dialog Version 30...","permalink":"/post/恶意iso文件分析","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"恶意样本","slug":"恶意样本","count":2,"path":"api/tags/恶意样本.json"},{"name":"逆向","slug":"逆向","count":8,"path":"api/tags/逆向.json"},{"name":"iso文件","slug":"iso文件","count":1,"path":"api/tags/iso文件.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#iso%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">iso信息</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">文件信息</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9\"><span class=\"toc-text\">文件内容</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#doc%E6%96%87%E6%A1%A3\"><span class=\"toc-text\">doc文档</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#doc%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">doc加密数据</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#WinWord-exe\"><span class=\"toc-text\">WinWord.exe</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AD%BE%E5%90%8D%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">签名信息</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">详细信息</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%90%E8%A1%8C\"><span class=\"toc-text\">运行</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%8A%A0%E8%BD%BD%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84MSVCR100-dll\"><span class=\"toc-text\">加载当前目录下的MSVCR100.dll</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E6%B3%A8%E5%86%8C%E8%A1%A8%E9%A1%B9\"><span class=\"toc-text\">创建注册表项</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1\"><span class=\"toc-text\">创建定时任务</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#MSVCR100-dll\"><span class=\"toc-text\">MSVCR100.dll</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#MSVCR100-dll%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">MSVCR100.dll信息</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8A%9F%E8%83%BD%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">第一个功能函数</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8A%9F%E8%83%BD%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">第二个功能函数</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%99%84%E5%BD%95\"><span class=\"toc-text\">附录</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5\"><span class=\"toc-text\">参考链接</span></a></li></ol>","author":{"name":"0netry","slug":"blog-author","avatar":"/img/tree.png","link":"/","description":"0与1只在一念之间","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"某白加黑木马样本分析","uid":"d8609f7faf5edcbbc1a1648becebe73e","slug":"某白加黑木马样本分析","date":"2025-05-28T05:39:13.000Z","updated":"2025-06-05T12:27:57.863Z","comments":true,"path":"api/articles/某白加黑木马样本分析.json","keywords":null,"cover":[],"text":"一、概述样本基本信息（4个文件）样本名称：a5c0Lm.exe、ClassicExplorer32.dll、ffff.pol、ffff.lop MD5：ae10...","permalink":"/post/某白加黑木马样本分析","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"恶意样本","slug":"恶意样本","count":2,"path":"api/tags/恶意样本.json"},{"name":"白加黑技术","slug":"白加黑技术","count":1,"path":"api/tags/白加黑技术.json"},{"name":"逆向","slug":"逆向","count":8,"path":"api/tags/逆向.json"}],"author":{"name":"0netry","slug":"blog-author","avatar":"/img/tree.png","link":"/","description":"0与1只在一念之间","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"C++逆向——虚基类指针&&虚基类表 vs 虚函数指针&&虚函数表","uid":"c3ef1bdebe04666f3d364f093474c8aa","slug":"C++逆向——虚基类指针&&虚基类表 vs 虚函数指针&&虚函数表","date":"2023-03-12T11:53:28.000Z","updated":"2025-06-07T18:59:17.248Z","comments":true,"path":"api/articles/C++逆向——虚基类指针&&虚基类表 vs 虚函数指针&&虚函数表.json","keywords":null,"cover":[],"text":"一、虚继承产生的虚基类表指针和虚基类表如下代码：写一个棱形继承，父类Father，子类Son1和Son2虚继承Base，又来一个类Grandson继承Son1和...","permalink":"/post/C++逆向——虚基类指针&&虚基类表 vs 虚函数指针&&虚函数表","photos":[],"count_time":{"symbolsCount":"7.1k","symbolsTime":"6 mins."},"categories":[],"tags":[{"name":"c++逆向","slug":"c-逆向","count":9,"path":"api/tags/c-逆向.json"}],"author":{"name":"0netry","slug":"blog-author","avatar":"/img/tree.png","link":"/","description":"0与1只在一念之间","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}